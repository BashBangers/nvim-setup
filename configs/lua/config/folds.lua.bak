-- ~/.config/nvim/lua/config/folds.lua

-- Treesitter-powered folds (modern API)
vim.opt.foldmethod = "expr"
vim.opt.foldexpr = "v:lua.vim.treesitter.foldexpr()"

-- Good defaults: start unfolded but folding enabled
vim.opt.foldenable = true
vim.opt.foldlevel = 99
vim.opt.foldlevelstart = 99
vim.opt.foldcolumn = "1" -- nice fold gutter (optional)

-- Handy mappings (optional)
vim.keymap.set("n", "zR", function()
	vim.cmd("normal! zR")
end, { desc = "Open all folds" })
vim.keymap.set("n", "zM", function()
	vim.cmd("normal! zM")
end, { desc = "Close all folds" })

-- Fallbacks where indent folding works better
vim.api.nvim_create_autocmd("FileType", {
	pattern = { "hcl", "terraform", "yaml", "gotmpl", "helm", "html" },
	callback = function()
		vim.opt_local.foldmethod = "indent"
		vim.opt_local.foldexpr = ""
	end,
})

-- If you actually prefer auto-close on open, uncomment:
-- vim.api.nvim_create_autocmd("BufReadPost", function() vim.cmd("silent! normal! zM") end)
